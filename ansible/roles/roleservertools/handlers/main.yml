---
# handlers file for roleservertools
- name: ClearHostsFile_loopback_localhost
  ansible.builtin.lineinfile:
    path: /etc/hosts
    line: "127.0.0.1 localhost"
    state: absent

- name: ClearHostsFile_loopback_servername
  ansible.builtin.lineinfile:
    path: /etc/hosts
    regexp: '^127\.0\.0\.1\s+(?!localhost\b)(\S+)'
    state: absent

- name: ClearHostsFile_ip_servername
  ansible.builtin.lineinfile:
    path: /etc/hosts
    search_string: "{{ ansible_default_ipv4.address }}"
    state: absent

#
- name: AddinHostsFile_loopback_localhost
  ansible.builtin.lineinfile:
    path: /etc/hosts
    line: "127.0.0.1 localhost"
    state: present

- name: AddinHostsFile_loopback_servername
  ansible.builtin.lineinfile:
    path: /etc/hosts
    regexp: '^127\.0\.0\.1\s+(?!localhost\b)(\S+)'
    line: "127.0.0.1 {{ hostname }}"
    state: present

- name: AddinHostsFile_ip_servername
  ansible.builtin.lineinfile:
    path: /etc/hosts
    search_string: "{{ ansible_default_ipv4.address }}"
    line: "{{ ansible_default_ipv4.address }} {{ hostname }}"
    state: present

#
- name: ClearAllEntries
  ansible.builtin.lineinfile:
    path: /etc/hosts
    search_string: "{{ hostvars[item]['ansible_default_ipv4']['address'] }}"
    state: absent
  loop: "{{ groups['all'] }}"
  when: hostvars[item]['ansible_default_ipv4']['address'] is defined

- name: UpdateAllEntries
  ansible.builtin.lineinfile:
    path: /etc/hosts
    line: "{{ hostvars[item]['ansible_default_ipv4']['address'] }} {{ hostvars[item]['hostname'] }} "
    state: present
  loop: "{{ groups['all'] }}"
  when: hostvars[item]['ansible_default_ipv4']['address'] is defined

#
- name: Debug
  ansible.builtin.debug:
    msg: "{{ hostvars[item]['ansible_default_ipv4']['address'] }} {{ hostvars[item]['hostname'] }} "
  loop: "{{ groups['all'] }}"
  when: hostvars[item]['ansible_default_ipv4']['address'] is defined
